#!/bin/bash

# Ensure the plugin and theme directories exist
mkdir -p wp-content/themes
mkdir -p wp-content/plugins

# Checkout/update VIP plugins
echo
echo "Checking out VIP Plugins..."
if [ -d "wp-content/themes/vip/plugins" ]; then
	svn up wp-content/themes/vip/plugins
else
	mkdir -p wp-content/themes/vip
	svn co https://vip-svn.wordpress.com/plugins/ wp-content/themes/vip/plugins
fi

# Checkout/update default theme
echo
echo "Checking out default theme..."
if [ -d "wp-content/themes/pub/twentysixteen" ]; then
	svn up wp-content/themes/pub/twentysixteen
else
	mkdir -p wp-content/themes/pub
	svn co https://wpcom-themes.svn.automattic.com/twentysixteen wp-content/themes/pub/twentysixteen
fi

# Clone Jetpack
echo
echo "Cloning Jetpack..."
if [ -d "wp-content/plugins/jetpack" ]; then
	cd wp-content/plugins/jetpack
	git reset --hard
	git pull
	cd -
else
	git clone -b master-stable https://github.com/Automattic/jetpack.git wp-content/plugins/jetpack
fi

# Update containers
echo
echo "Updating containers"
docker-compose pull
if [ -f ../docker-custom.yml ]; then
	docker-compose -f docker-compose.yml -f docker-custom.yml up --build -d
else
	docker-compose up --build -d
fi

echo
echo "Done"

echo
grep "wp.local" /etc/hosts > /dev/null || echo 'Be sure to add `127.0.0.1 wp.local` to your /etc/hosts file'
